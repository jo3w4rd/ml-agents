<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Using Docker For ML-Agents </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Using Docker For ML-Agents ">
    <meta name="generator" content="docfx 2.34.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc">
    <meta property="docfx:tocrel" content="toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" src="../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                <ul class="nav level1 navbar-nav">
                  <li class="active">
                    <a href="../articles/ML-Agents-Overview.html" title="Manual" class="active">Manual</a>
                  </li>
                  <li class="">
                    <a href="../zh-CN/ML-Agents-Overview.html" title="Chinese Manual" class="">Chinese Manual</a>
                  </li>
                  <li class="">
                    <a href="../csharp-api/Unity.MLAgents.html" title="C# Script Reference" class="">C# Script Reference</a>
                  </li>
                  <li class="">
                    <a href="../python-api/Python-API.html" title="Python Script Reference" class="">Python Script Reference</a>
                  </li>
                </ul>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Getting Started</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="ML-Agents-Overview.html" title="ML-Agents Overview" class="">ML-Agents Overview</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="Background-Unity.html" title="Background Unity" class="">Background Unity</a>
                                </li>
                                <li class="">
                                  <a href="Background-Machine-Learning.html" title="Background Machine Learning" class="">Background Machine Learning</a>
                                </li>
                                <li class="">
                                  <a href="Background-TensorFlow.html" title="Background TensorFlow" class="">Background TensorFlow</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="Installation.html" title="Installation &amp; Setup" class="">Installation &amp; Setup</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="Background-Jupyter.html" title="Background Jupyter Notebooks" class="">Background Jupyter Notebooks</a>
                                </li>
                                <li class="active">
                                  <a href="Using-Docker.html" title="Background Docker Setup" class="active">Background Docker Setup</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <a href="Getting-Started-with-Balance-Ball.html" title="Getting Started with the 3D Balance Ball Environment" class="">Getting Started with the 3D Balance Ball Environment</a>
                          </li>
                          <li class="">
                            <a href="Learning-Environment-Examples.html" title="Example Environment" class="">Example Environment</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Creating Learning Environments</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="Learning-Environment-Create-New.html" title="Making a New Learning environment" class="">Making a New Learning environment</a>
                          </li>
                          <li class="">
                            <a href="Learning-Environment-Design.html" title="Designing a Learning environment" class="">Designing a Learning environment</a>
                          </li>
                          <li class="">
                            <a href="Learning-Environment-Best-Practices.html" title="Learning Environment Best Practices" class="">Learning Environment Best Practices</a>
                          </li>
                          <li class="">
                            <a href="Feature-Monitor.html" title="Using the Monitor Class" class="">Using the Monitor Class</a>
                          </li>
                          <li class="">
                            <a href="Using-TensorFlow-Sharp-in-Unity.html" title="TensorFlowSharp in Unity" class="">TensorFlowSharp in Unity</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Training</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="Training-ML-Agents.html" title="Training ML-Agents" class="">Training ML-Agents</a>
                          </li>
                          <li class="">
                            <a href="Training-PPO.html" title="Training with Proximal Policy Optimization" class="">Training with Proximal Policy Optimization</a>
                          </li>
                          <li class="">
                            <a href="Training-Curriculum-Learning.html" title="Training with Curriculum Learning" class="">Training with Curriculum Learning</a>
                          </li>
                          <li class="">
                            <a href="Training-Imitation-Learning.html" title="Training with Imitation Learning" class="">Training with Imitation Learning</a>
                          </li>
                          <li class="">
                            <a href="Feature-Memory.html" title="Training with LSTM" class="">Training with LSTM</a>
                          </li>
                          <li class="">
                            <a href="Training-on-Amazon-Web-Service.html" title="Training on the Cloud with Amazon Web Services" class="">Training on the Cloud with Amazon Web Services</a>
                          </li>
                          <li class="">
                            <a href="Using-Tensorboard.html" title="Using TensorBoard to Observe Training" class="">Using TensorBoard to Observe Training</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Help</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="Migrating-v0.3.html" title="Migrating to ML-Agents v.0.3" class="">Migrating to ML-Agents v.0.3</a>
                          </li>
                          <li class="">
                            <a href="Glossary.html" title="ML-Agents Glossary" class="">ML-Agents Glossary</a>
                          </li>
                          <li class="">
                            <a href="Limitations-and-Common-Issues.html" title="Limitations &amp; Common Issues" class="">Limitations &amp; Common Issues</a>
                          </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="using-docker-for-ml-agents">Using Docker For ML-Agents</h1>

<p>We currently offer a solution for Windows and Mac users who would like to do training or inference using Docker. This option may be appealing to those who would like to avoid installing Python and TensorFlow themselves. The current setup forces both TensorFlow and Unity to <em>only</em> rely on the CPU for computations. Consequently, our Docker simulation does not use a GPU and uses <a href="https://en.wikipedia.org/wiki/Xvfb"><code>Xvfb</code></a> to do visual rendering. <code>Xvfb</code> is a utility that enables <code>ML-Agents</code> (or any other application) to do rendering virtually i.e. it does not assume that the machine running <code>ML-Agents</code> has a GPU or a display attached to it. This means that rich environments which involve agents using camera-based visual observations might be slower.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Unity <em>Linux Build Support</em> Component</li>
<li><a href="https://www.docker.com">Docker</a></li>
</ul>
<h2 id="setup">Setup</h2>
<ul>
<li><p><a href="https://unity3d.com/get-unity/download">Download</a> the Unity Installer and
add the <em>Linux Build Support</em> Component</p>
</li>
<li><p><a href="https://www.docker.com/community-edition#/download">Download</a> and
install Docker if you don&#39;t have it setup on your machine.</p>
</li>
<li><p>Since Docker runs a container in an environment that is isolated from the host machine, a mounted directory in your host machine is used to share data, e.g. the Unity executable, curriculum files and TensorFlow graph. For convenience, we created an empty <code>unity-volume</code> directory at the root of the repository for this purpose, but feel free to use any other directory. The remainder of this guide assumes that the <code>unity-volume</code> directory is the one used.</p>
</li>
</ul>
<h2 id="usage">Usage</h2>
<p>Using Docker for ML-Agents involves three steps: building the Unity environment with specific flags, building a Docker container and, finally, running the container. If you are not familiar with building a Unity environment for ML-Agents, please read through our <a href="Getting-Started-with-Balance-Ball.html">Getting Started with the 3D Balance Ball Example</a> guide first.</p>
<h3 id="build-the-environment">Build the Environment</h3>
<p>Since Docker typically runs a container sharing a (linux) kernel with the host machine, the 
Unity environment <strong>has</strong> to be built for the <strong>linux platform</strong>. When building a Unity environment, please select the following options from the the Build Settings window:</p>
<ul>
<li>Set the <em>Target Platform</em> to <code>Linux</code></li>
<li>Set the <em>Architecture</em> to <code>x86_64</code></li>
<li>If the environment does not contain visual observations, you can select the <code>headless</code> option here.</li>
</ul>
<p>Then click <code>Build</code>, pick an environment name (e.g. <code>3DBall</code>) and set the output directory to <code>unity-volume</code>. After building, ensure that the file <code>&lt;environment-name&gt;.x86_64</code> and subdirectory <code>&lt;environment-name&gt;_Data/</code> are created under <code>unity-volume</code>.</p>
<p><img src="../images/docker_build_settings.png" alt="Build Settings For Docker"></p>
<h3 id="build-the-docker-container">Build the Docker Container</h3>
<p>First, make sure the Docker engine is running on your machine. Then build the Docker container by calling the following command at the top-level of the repository:</p>
<pre><code>docker build -t &lt;image-name&gt; .
</code></pre><p>Replace <code>&lt;image-name&gt;</code> with a name for the Docker image, e.g. <code>balance.ball.v0.1</code>.</p>
<h3 id="run-the-docker-container">Run the Docker Container</h3>
<p>Run the Docker container by calling the following command at the top-level of the repository:</p>
<pre><code>docker run --name &lt;container-name&gt; \
           --mount type=bind,source=&quot;$(pwd)&quot;/unity-volume,target=/unity-volume \
           &lt;image-name&gt;:latest &lt;environment-name&gt; \
           --docker-target-name=unity-volume \
           --train \
           --run-id=&lt;run-id&gt;
</code></pre><p>Notes on argument values:</p>
<ul>
<li><code>&lt;container-name&gt;</code> is used to identify the container (in case you want to interrupt and terminate it). This is optional and Docker will generate a random name if this is not set. <em>Note that this must be unique for every run of a Docker image.</em></li>
<li><code>&lt;image-name&gt;</code> and <code>&lt;environment-name&gt;</code>: References the image and environment names, respectively.</li>
<li><code>source</code>: Reference to the path in your host OS where you will store the Unity executable. </li>
<li><code>target</code>: Tells Docker to mount the <code>source</code> path as a disk with this name. </li>
<li><code>docker-target-name</code>: Tells the ML-Agents Python package what the name of the disk where it can read the Unity executable and store the graph. <strong>This should therefore be identical to <code>target</code>.</strong></li>
<li><code>train</code>, <code>run-id</code>: ML-Agents arguments passed to <code>learn.py</code>. <code>train</code> trains the algorithm, <code>run-id</code> is used to tag each experiment with a unique identifier. </li>
</ul>
<p>For the <code>3DBall</code> environment, for example this would be:</p>
<pre><code>docker run --name 3DBallContainer.first.trial \
           --mount type=bind,source=&quot;$(pwd)&quot;/unity-volume,target=/unity-volume \
           balance.ball.v0.1:latest 3DBall \
           --docker-target-name=unity-volume \
           --train \
           --run-id=3dball_first_trial
</code></pre><p>For more detail on Docker mounts, check out <a href="https://docs.docker.com/storage/bind-mounts/">these</a> docs from Docker.</p>
<h3 id="stopping-container-and-saving-state">Stopping Container and Saving State</h3>
<p>If you are satisfied with the training progress, you can stop the Docker container while saving state by either using <code>Ctrl+C</code> or <code>⌘+C</code> (Mac) or by using the following command:</p>
<pre><code>docker kill --signal=SIGINT &lt;container-name&gt;
</code></pre><p><code>&lt;container-name&gt;</code> is the name of the container specified in the earlier <code>docker run</code> command. If you didn&#39;t specify one, you can find the randomly generated identifier by running <code>docker container ls</code>.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/Unity-Technologies/ml-agents/blob/feature-docfx/doc-src/articles/Using-Docker.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
