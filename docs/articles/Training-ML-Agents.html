<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Training ML-Agents </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Training ML-Agents ">
    <meta name="generator" content="docfx 2.34.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc">
    <meta property="docfx:tocrel" content="toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" src="../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                <ul class="nav level1 navbar-nav">
                  <li class="active">
                    <a href="../articles/ML-Agents-Overview.html" title="Manual" class="active">Manual</a>
                  </li>
                  <li class="">
                    <a href="../zh-CN/ML-Agents-Overview.html" title="Chinese Manual" class="">Chinese Manual</a>
                  </li>
                  <li class="">
                    <a href="../csharp-api/Unity.MLAgents.html" title="C# Script Reference" class="">C# Script Reference</a>
                  </li>
                  <li class="">
                    <a href="../python-api/Python-API.html" title="Python Script Reference" class="">Python Script Reference</a>
                  </li>
                </ul>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Getting Started</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="ML-Agents-Overview.html" title="ML-Agents Overview" class="">ML-Agents Overview</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="Background-Unity.html" title="Background Unity" class="">Background Unity</a>
                                </li>
                                <li class="">
                                  <a href="Background-Machine-Learning.html" title="Background Machine Learning" class="">Background Machine Learning</a>
                                </li>
                                <li class="">
                                  <a href="Background-TensorFlow.html" title="Background TensorFlow" class="">Background TensorFlow</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="Installation.html" title="Installation &amp; Setup" class="">Installation &amp; Setup</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="Background-Jupyter.html" title="Background Jupyter Notebooks" class="">Background Jupyter Notebooks</a>
                                </li>
                                <li class="">
                                  <a href="Using-Docker.html" title="Background Docker Setup" class="">Background Docker Setup</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <a href="Getting-Started-with-Balance-Ball.html" title="Getting Started with the 3D Balance Ball Environment" class="">Getting Started with the 3D Balance Ball Environment</a>
                          </li>
                          <li class="">
                            <a href="Learning-Environment-Examples.html" title="Example Environment" class="">Example Environment</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Creating Learning Environments</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="Learning-Environment-Create-New.html" title="Making a New Learning environment" class="">Making a New Learning environment</a>
                          </li>
                          <li class="">
                            <a href="Learning-Environment-Design.html" title="Designing a Learning environment" class="">Designing a Learning environment</a>
                          </li>
                          <li class="">
                            <a href="Learning-Environment-Best-Practices.html" title="Learning Environment Best Practices" class="">Learning Environment Best Practices</a>
                          </li>
                          <li class="">
                            <a href="Feature-Monitor.html" title="Using the Monitor Class" class="">Using the Monitor Class</a>
                          </li>
                          <li class="">
                            <a href="Using-TensorFlow-Sharp-in-Unity.html" title="TensorFlowSharp in Unity" class="">TensorFlowSharp in Unity</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Training</a>
                        
                        <ul class="nav level2">
                          <li class="active">
                            <a href="Training-ML-Agents.html" title="Training ML-Agents" class="active">Training ML-Agents</a>
                          </li>
                          <li class="">
                            <a href="Training-PPO.html" title="Training with Proximal Policy Optimization" class="">Training with Proximal Policy Optimization</a>
                          </li>
                          <li class="">
                            <a href="Training-Curriculum-Learning.html" title="Training with Curriculum Learning" class="">Training with Curriculum Learning</a>
                          </li>
                          <li class="">
                            <a href="Training-Imitation-Learning.html" title="Training with Imitation Learning" class="">Training with Imitation Learning</a>
                          </li>
                          <li class="">
                            <a href="Feature-Memory.html" title="Training with LSTM" class="">Training with LSTM</a>
                          </li>
                          <li class="">
                            <a href="Training-on-Amazon-Web-Service.html" title="Training on the Cloud with Amazon Web Services" class="">Training on the Cloud with Amazon Web Services</a>
                          </li>
                          <li class="">
                            <a href="Using-Tensorboard.html" title="Using TensorBoard to Observe Training" class="">Using TensorBoard to Observe Training</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Help</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="Migrating-v0.3.html" title="Migrating to ML-Agents v.0.3" class="">Migrating to ML-Agents v.0.3</a>
                          </li>
                          <li class="">
                            <a href="Glossary.html" title="ML-Agents Glossary" class="">ML-Agents Glossary</a>
                          </li>
                          <li class="">
                            <a href="Limitations-and-Common-Issues.html" title="Limitations &amp; Common Issues" class="">Limitations &amp; Common Issues</a>
                          </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="training-ml-agents">Training ML-Agents</h1>

<p>ML-Agents conducts training using an external Python training process. During training, this external process communicates with the Academy object in the Unity scene to generate a block of agent experiences. These experiences become the training set for a neural network used to optimize the agent&#39;s policy (which is essentially a mathematical function mapping observations to actions). In reinforcement learning, the neural network optimizes the policy by maximizing the expected rewards. In imitation learning, the neural network optimizes the policy to achieve the smallest difference between the actions chosen by the agent trainee and the actions chosen by the expert in the same situation. </p>
<p>The output of the training process is a model file containing the optimized policy. This model file is a TensorFlow data graph containing the mathematical operations and the optimized weights selected during the training process. You can use the generated model file with the Internal Brain type in your Unity project to decide the best course of action for an agent. </p>
<p>Use the Python program, <code>learn.py</code> to train your agents. This program can be found in the <code>python</code> directory of the ML-Agents SDK. The <a href="#training-config-file">configuration file</a>, <code>trainer_config.yaml</code> specifies the hyperparameters used during training. You can edit this file with a text editor to add a specific configuration for each brain.</p>
<p>For a broader overview of reinforcement learning, imitation learning and the ML-Agents training process, see <a href="ML-Agents-Overview.html">ML-Agents Overview</a>.</p>
<h2 id="training-with-learnpy">Training with Learn.py</h2>
<p>Use the Python <code>Learn.py</code> program to train agents. <code>Learn.py</code> supports training with <a href="Background-Machine-Learning.html#reinforcement-learning">reinforcement learning</a>, <a href="Training-Curriculum-Learning.html">curriculum learning</a>, and <a href="Training-Imitation-Learning.html">behavioral cloning imitation learning</a>.</p>
<p>Run <code>Learn.py</code> from the command line to launch the training process. Use the command line patterns and the <code>trainer_config.yaml</code> file to control training options.</p>
<p>The basic command for training is:</p>
<pre><code>python3 learn.py &lt;env_file_path&gt; --run-id=&lt;run-identifier&gt; --train
</code></pre><p>where <code>&lt;env_file_path&gt;</code> is the path to your Unity executable containing the agents to be trained and <code>&lt;run-identifier&gt;</code> is an optional identifier you can use to identify the results of individual training runs.</p>
<p>For example, suppose you have a project in Unity named &quot;CatsOnBicyclesCatsOnBicycles&quot; which contains agents ready to train. To perform the training:</p>
<ol>
<li>Build the project, making sure that you only include the training scene.</li>
<li>Open a terminal or console window.</li>
<li>Navigate to the ml-agents <code>python</code> folder.</li>
<li><p>Run the following to launch the training process using the path to the Unity environment you built in step 1:</p>
<pre><code> python3 learn.py ../../projects/Cats/CatsOnBicycles.app --run-id=cob_1 --train
</code></pre></li>
</ol>
<p>During a training session, the training program prints out and saves updates at regular intervals (specified by the <code>summary_freq</code> option). The saved statistics are grouped by the <code>run-id</code> value so you should assign a unique id to each training run if you plan to view the statistics. You can view these statistics using TensorBoard during or after training by running the following command (from the ML-Agents python directory):</p>
<pre><code>tensorboard --logdir=summaries
</code></pre><p>And then opening the URL: <a href="http://localhost:6006">localhost:6006</a>.</p>
<p>When training is finished, you can find the saved model in the <code>python/models</code> folder under the assigned run-id — in the cats example, the path to the model would be <code>python/models/cob_1/CatsOnBicycles_cob_1.bytes</code>.</p>
<p>While this example used the default training hyperparameters, you can edit the <a href="#training-config-file">training_config.yaml file</a> with a text editor to set different values. </p>
<h3 id="command-line-training-options">Command line training options</h3>
<p>In addition to passing the path of the Unity executable containing your training environment, you can set the following command line options when invoking <code>learn.py</code>:</p>
<ul>
<li><code>--curriculum=&lt;file&gt;</code> – Specify a curriculum JSON file for defining the lessons for curriculum training. See <a href="Training-Curriculum-Learning.html">Curriculum Training</a> for more information.</li>
<li><code>--keep-checkpoints=&lt;n&gt;</code> – Specify the maximum number of model checkpoints to keep. Checkpoints are saved after the number of steps specified by the <code>save-freq</code> option. Once the maximum number of checkpoints has been reached, the oldest checkpoint is deleted when saving a new checkpoint. Defaults to 5.</li>
<li><code>--lesson=&lt;n&gt;</code> – Specify which lesson to start with when performing curriculum training. Defaults to 0.</li>
<li><code>--load</code> – If set, the training code loads an already trained model to initialize the neural network before training. The learning code looks for the model in <code>python/models/&lt;run-id&gt;/</code> (which is also where it saves models at the end of training). When not set (the default), the neural network weights are randomly initialized and an existing model is not loaded.</li>
<li><code>--run-id=&lt;path&gt;</code> – Specifies an identifier for each training run. This identifier is used to name the subdirectories in which the trained model and summary statistics are saved as well as the saved model itself. The default id is &quot;ppo&quot;. If you use TensorBoard to view the training statistics, always set a unique run-id for each training run. (The statistics for all runs with the same id are combined as if they were produced by a the same session.)</li>
<li><code>--save-freq=&lt;n&gt;</code> Specifies how often (in  steps) to save the model during training. Defaults to 50000.</li>
<li><code>--seed=&lt;n&gt;</code> – Specifies a number to use as a seed for the random number generator used by the training code.</li>
<li><code>--slow</code> – Specify this option to run the Unity environment at normal, game speed. The <code>--slow</code> mode uses the <strong>Time Scale</strong> and <strong>Target Frame Rate</strong> specified in the Academy&#39;s <strong>Inference Configuration</strong>. By default, training runs using the speeds specified in your Academy&#39;s <strong>Training Configuration</strong>. See <a href="Learning-Environment-Design-Academy.html#academy-properties">Academy Properties</a>.</li>
<li><code>--train</code> – Specifies whether to train model or only run in inference mode. When training, <strong>always</strong> use the <code>--train</code> option.</li>
<li><code>--worker-id=&lt;n&gt;</code> – When you are running more than one training environment at the same time, assign each a unique worker-id number. The worker-id is added to the communication port opened between the current instance of learn.py and the ExternalCommunicator object in the Unity environment. Defaults to 0.</li>
<li><code>--docker-target-name=&lt;dt&gt;</code> – The Docker Volume on which to store curriculum, executable and model files. See <a href="Using-Docker.html">Using Docker</a>.</li>
</ul>
<h3 id="training-config-file">Training config file</h3>
<p>The training config file, <code>trainer_config.yaml</code> specifies the training method, the hyperparameters, and a few additional values to use during training. The file is divided into sections. The <strong>default</strong> section defines the default values for all the available settings. You can also add new sections to override these defaults to train specific Brains. Name each of these override sections after the GameObject containing the Brain component that should use these settings. (This GameObject will be a child of the Academy in your scene.) Sections for the example environments are included in the provided config file. <code>Learn.py</code> finds the config file by name and looks for it in the same directory as itself.</p>
<table>
<thead>
<tr>
<th style="text-align:left">** Setting **</th>
<th style="text-align:left"><strong>Description</strong></th>
<th style="text-align:left"><strong>Applies To Trainer</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">batch_size</td>
<td style="text-align:left">The number of experiences in each iteration of gradient descent.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">batches_per_epoch</td>
<td style="text-align:left">In imitation learning, the number of batches of training examples to collect before training the model.</td>
<td style="text-align:left">BC</td>
</tr>
<tr>
<td style="text-align:left">beta</td>
<td style="text-align:left">The strength of entropy regularization.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">brain_to_imitate</td>
<td style="text-align:left">For imitation learning, the name of the GameObject containing the Brain component to imitate.</td>
<td style="text-align:left">BC</td>
</tr>
<tr>
<td style="text-align:left">buffer_size</td>
<td style="text-align:left">The number of experiences to collect before updating the policy model.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">epsilon</td>
<td style="text-align:left">Influences how rapidly the policy can evolve during training.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">gamma</td>
<td style="text-align:left">The reward discount rate for the Generalized Advantage Estimator (GAE).</td>
<td style="text-align:left">PPO</td>
</tr>
<tr>
<td style="text-align:left">hidden_units</td>
<td style="text-align:left">The number of units in the hidden layers of the neural network.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">lambd</td>
<td style="text-align:left">The regularization parameter.</td>
<td style="text-align:left">PPO</td>
</tr>
<tr>
<td style="text-align:left">learning_rate</td>
<td style="text-align:left">The initial learning rate for gradient descent.</td>
<td style="text-align:left">PPO,  BC</td>
</tr>
<tr>
<td style="text-align:left">max_steps</td>
<td style="text-align:left">The maximum number of simulation steps to run during a training session.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">memory_size</td>
<td style="text-align:left">The size of the memory an agent must keep. Used for training with a recurrent neural network. See <a href="Feature-Memory.html">Using Recurrent Neural Networks</a>.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">normalize</td>
<td style="text-align:left">Whether to automatically normalize observations.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">num_epoch</td>
<td style="text-align:left">The number of passes to make through the experience buffer when performing gradient descent optimization.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">num_layers</td>
<td style="text-align:left">The number of hidden layers in the neural network.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">sequence_length</td>
<td style="text-align:left">Defines how long the sequences of experiences must be while training. Only used for training with a recurrent neural network. See <a href="Feature-Memory.html">Using Recurrent Neural Networks</a>.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">summary_freq</td>
<td style="text-align:left">How often, in steps, to save training statistics. This determines the number of data points shown by TensorBoard.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">time_horizon</td>
<td style="text-align:left">How many steps of experience to collect per-agent before adding it to the experience buffer.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">trainer</td>
<td style="text-align:left">The type of training to perform: &quot;ppo&quot; or &quot;imitation&quot;.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left">use_recurrent</td>
<td style="text-align:left">Train using a recurrent neural network. See <a href="Feature-Memory.html">Using Recurrent Neural Networks</a>.</td>
<td style="text-align:left">PPO, BC</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">PPO = Proximal Policy Optimization, BC = Behavioral Cloning (Imitation))</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<p>For specific advice on setting hyperparameters based on the type of training you are conducting, see:</p>
<ul>
<li><a href="Training-PPO.html">Training with PPO</a></li>
<li><a href="Feature-Memory.html">Using Recurrent Neural Networks</a></li>
<li><a href="Training-Curriculum-Learning.html">Training with Curriculum Learning</a></li>
<li><a href="Training-Imitation-Learning.html">Training with Imitation Learning</a></li>
</ul>
<p>You can also compare the <a href="Learning-Environment-Examples.html">example environments</a> to the corresponding sections of the <code>trainer-config.yaml</code> file for each example to see how the hyperparameters and other configuration variables have been changed from the defaults.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/Unity-Technologies/ml-agents/blob/feature-docfx/doc-src/articles/Training-ML-Agents.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
